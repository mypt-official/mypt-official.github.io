---
layout: post
title:  "ì˜ì¡´ì„± ì£¼ì…ì˜ KoinğŸª™ ë‘ ë‹¢ì„ - 2"
date:   2022-06-26 23:00:00 +0900
categories: [í”„ë¡œê·¸ë˜ë°]
---

# ì˜ì¡´ì„± ì£¼ì…ì˜ KoinğŸª™Â ë‘ ë‹¢ì„ - 2

ì´ë²ˆì—” ì‹¤ì œë¡œ í”„ë¡œê·¸ë¨ì— ì˜ì¡´ì„± ì£¼ì…(DI)ë¥¼ ì ìš©ì‹œì¼œë³´ë©´ì„œ ì‚½ì§ˆì˜ ì—°ì†ì—ì„œ ëŠê¼ˆë˜ ì ê³¼ í•„ìš”í•œ ë¶€ë¶„ì„ ì‘ì„±í•  ì˜ˆì •ì…ë‹ˆë‹¤.

1. Fragmentë¼ë¦¬ ViewModelì„ ê³µìœ í•˜ê³  ì‹¶ì„ ë•Œ!

```kotlin
class JoinEntrepreneurFragment: Fragment() {
	...
	private val viewModel: JoinViewModel by sharedViewModel()

	...
}

class JoinMainFragment : SoftKeyboardImplementFragment() {
	...
	private val viewModel: JoinViewModel by sharedViewModel()

	...
}
```

ìœ„ì™€ ê°™ì€ í˜•ì‹ìœ¼ë¡œ sharedViewModel() ë¥¼ ì ì–´ì¤€ë‹¤ë©´ Fragmentê°„ ë°ì´í„°ë¥¼ ìœ ì§€ & ê³µìœ ê°€ ê°€ëŠ¥í•´ì§‘ë‹ˆë‹¤.

1. Retrofit2 ì„œë²„ í˜¸ì¶œ ë°©ë²•

ì„œë²„í˜¸ì¶œì— í•„ìš”í•œ Retrofitë„ ì˜ì¡´ì„± ì£¼ì…ì„ í•˜ëŠ”ë° ë°©ë²•ì€ ê°„ë‹¨í•˜ì§€ ì•Šì§€ë§Œ ê°„ë‹¨í•˜ë‹¤ê³  ìƒê°í•˜ë ¤ í•©ë‹ˆë‹¤. ğŸ˜¢

```kotlin
val remoteModule = module {

		// ì„œë²„í˜¸ì¶œì— Logë¥¼ ë³´ì—¬ì¤Œ
    single {
        HttpLoggingInterceptor().apply {
            level = if (BuildConfig.DEBUG) HttpLoggingInterceptor.Level.BODY else HttpLoggingInterceptor.Level.NONE
        }
    }

		// í† í°ê´€ë ¨ ì¸í„°ì…‰í„°
    single {
        TokenInterceptor(get(), get(), get())
    }

		// Gsoní˜•ì‹ì„ ë³€í™˜í•  ë•Œ í•„ìš”
    single<GsonConverterFactory> { GsonConverterFactory.create(get()) }

		// retrofitì„ ì‚¬ìš©í•˜ê¸° ìœ„í•œ OkHttp ë¹Œë“œ
    single {
        OkHttpClient.Builder()
            .addInterceptor(get<HttpLoggingInterceptor>())
            .addInterceptor(get<TokenAuthenticator>())
            .readTimeout(10, TimeUnit.SECONDS)
            .build()
    }

		// retrofit ì˜ì¡´ì„± ì£¼ì…
		// named ëŠ” ë˜‘ê°™ì€ Retrofitì„ ì„ ì–¸í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ì´ë¦„ì„ ë‹¬ë¦¬í•´ì„œ ì‹¤ì œ ì‚¬ìš©ì‹œ êµ¬ë¶„ì„ ìœ„í•œ ì½”ë“œ
		single<Retrofit>(named(BaseQualifier.HWACHA_API)) { 
        Retrofit.Builder()
            .baseUrl(BuildConfig.BASE_URL)
            .client(get<OkHttpClient>())
            .addCallAdapterFactory(RxJava2CallAdapterFactory.create())
            .addConverterFactory(get<GsonConverterFactory>())
            .build()
    }

    single<OnBoardingApi> { // ì•„ë˜ì— named ì‚¬ìš© ì‚¬ë¡€.
        get<Retrofit>(named(BaseQualifier.HWACHA_API)).create(
            OnBoardingApi::class.java
        )
    }

}
```

1. Repository ìƒì„±

ì„œë²„ í˜¸ì¶œ ê°œë°œì„ í•˜ë©´ì„œ interfaceë¥¼ ìƒì† ë°›ìœ¼ë©´ì„œ ì˜ì¡´ì„± ì£¼ì…í•˜ëŠ” ë°©ë²•ì´ë‹¤.

ì´ ë¶€ë¶„ì—ì„œ êµ‰ì¥íˆ ì´í•´í•˜ê¸° í˜ë“¤ì—ˆê³  ì•„ì§ ê°œë°œì„ í•˜ë©´ì„œ ë” ìµìˆ™í•´ì ¸ì•¼í•˜ëŠ” ë¶€ë¶„ì´ë¼ ìƒê°í•œë‹¤.

```kotlin
// OnBoardingRepository.kt
interface OnBoardingRepository {
		var postAuthResponse: MutableLiveData<Resource<AuthResponse>>
    ...

    fun postAuth(postAuthRequest: AuthRequest)
    ...
}

// OnBoardingRepositoryImpl.kt

class OnBoardingRepositoryImpl(
    private val onBoardingApi: OnBoardingApi,
    private val gson: Gson,
) : OnBoardingRepository {
		override var postAuthResponse: MutableLiveData<Resource<AuthResponse>> = MutableLiveData()
		...

		override fun postAuth(postAuthRequest: AuthRequest) {
				...
		}
		...
}

// RepositoryModule.kt
// ìœ„ interfaceì™€ ìƒì† ë°›ì€ implì„ ì‘ì„± í›„ ëª¨ë“ˆì— ì ì–´ì¤ë‹ˆë‹¤.
val repositoryModule = module {
    single<OnBoardingRepository> { OnBoardingRepositoryImpl(get(), get()) }
		...
}
```

ì´ë•Œ ì‹¤ì œ ì‚¬ìš©ë°©ë²•ì€ interfaceë¥¼ get()ìœ¼ë¡œ ì˜ì¡´ì„± ì£¼ì…ì„ í•©ë‹ˆë‹¤.

```kotlin

// ViewModelModule.kt
val viewModelModule = module {
    viewModel { JoinViewModel(get()) }
		...
}

// JoinViewModel.kt

class JoinViewModel(
    private val onBoardingRepo: OnBoardingRepository
) : ViewModel() {
		
		fun getAuth() {
				onBoardingRepo.postAuth(PostAuthRequest(...))
		}
}
```

ìœ„ì™€ ê°™ì€ ë°©ë²•ìœ¼ë¡œ ì‚¬ìš©í•˜ë©´ interfaceë¥¼ ìƒì†ë°›ì€ implì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ë¯¸ì§€ ì—†ì´ ì½”ë“œë¡œë§Œ ì ìš©í•˜ì—¬ ê¸°ì–µí•˜ê¸° ì–´ë µê³  ì ìš©ì‹œí‚¤ê¸° ì–´ë ¤ìš¸ ê²ƒìœ¼ë¡œ ì˜ˆìƒì´ ë˜ì§€ë§Œ ê³„ì†í•´ì„œ ì‚¬ìš©í•  ê²ƒì´ê¸° ë•Œë¬¸ì— ì¶”í›„ì— ê³„ì† ë³€ê²½ì‚¬í•­ì´ ìƒê¸°ë©´ ì¶”ê°€, ìˆ˜ì •í•  ì˜ˆì •ì…ë‹ˆë‹¤~

1. ëŠë‚€ì 

ì´ë²ˆ ì£¼ Koinì„ ì ìš©í•´ì„œ ê°œë°œí•  ë•Œ ëŠê¼ˆë˜ ì ì€ â€œì •ë§ ì‘ì€ í”„ë¡œì íŠ¸ì— ì˜ì¡´ì„± ì£¼ì…ì„ í•˜ëŠ”ê²Œ ë§ì„ê¹Œ?â€ ë¼ëŠ” ìƒê°ì´ ê³„ì† ë“¤ì—ˆì§€ë§Œ ì‘ì€ í”„ë¡œì íŠ¸ì— ë„£ê³  ì‹œì‘í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ì¡°ê¸ˆì´ë¼ë„ ì»¤ì¡Œì„ ë•Œ ì ìš©ì‹œí‚¤ê¸° ë„ˆë¬´ í˜ë“¤ ê²ƒìœ¼ë¡œ ì˜ˆìƒì´ ë˜ì„œ í˜ë“¤ì§€ë§ŒğŸ˜« ì‚½ì§ˆğŸ› í•˜ë©´ì„œ í•œ ê±¸ìŒ í•œ ê±¸ìŒ ë‚˜ì•„ê°ˆ ì˜ˆì •ì…ë‹ˆë‹¤.