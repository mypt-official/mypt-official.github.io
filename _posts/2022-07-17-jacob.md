---
layout: post
title:  "Jetpack ğŸ“„Paging3ì˜ í˜ì´ì§€ë¥¼ ë„˜ê¸°ë©° - 1"
date:   2022-07-17 22:00:00 +0900
categories: [í”„ë¡œê·¸ë˜ë°]
---


# Jetpack ğŸ“„Paging3ì˜ í˜ì´ì§€ë¥¼ ë„˜ê¸°ë©° - 1

ì¼ë‹¨ ë“¤ì–´ê°€ê¸°ì— ì•ì„œ Paging ì´ë€ ë­”ê°€ìš”?

â†’ Pagingì€ ë°ì´í„°ë¥¼ ì„œë²„ì—ì„œ(í˜¹ì€ ë‹¤ë¥¸ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´) ê°€ì ¸ì˜¬ ë•Œ í•œ ë²ˆì— ëª¨ë“  ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ë‚˜ëˆ ì„œ ê°€ì ¸ì˜¤ëŠ” ê²ƒì„ ë§í•©ë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ë©´, 1,000,000ê°œ(ë°±ë§Œ)ì˜ ê²Œì‹œê¸€ ë°ì´í„°ë¥¼ ê°€ì§€ê³  ìˆëŠ” ì„œë²„ì—ì„œ ê²Œì‹œê¸€ ëª©ë¡ì„ ë³´ë ¤ê³  í˜¸ì¶œì„ í•˜ë ¤í•œë‹¤.

ê·¸ ë•Œ ëª¨ë“  ë°ì´í„°ë¥¼ í˜¸ì¶œí•˜ê²Œ ë˜ë©´ ë¶ˆëŸ¬ì˜¤ëŠ” ì‹œê°„ì´ ë‹¹ì—°íˆ ì˜¤ë˜ ê±¸ë¦´ ê²ƒì´ê³  ë°ì´í„° ì‚¬ìš©ëŸ‰ë„ ë§ì•„ì ¸ ì‚¬ìš©ì„±ì— êµ‰ì¥íˆ ì¢‹ì§€ ì•Šì£ .

ê·¸ë˜ì„œ ë°ì´í„°ë¥¼ ë‚˜ëˆ ì„œ ê°€ì ¸ì˜¤ê²Œ ì„œë²„ í˜¹ì€ ì•±ì—ì„œë„ ëª‡ ê°œì”©ë§Œ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì•±ì—ì„œëŠ” ë§ì€ ê²ƒë“¤ì„ ì„¤ì •í•´ì¤˜ì•¼í•˜ì£ .

1. ListView or RecyclerViewë¥¼ ì¼ì • ë¶€ë¶„ ìŠ¤í¬ë¡¤ í•˜ê²Œ ë˜ë©´ ì¸ì‹í•´ì„œ ì„œë²„í˜¸ì¶œì„ í•˜ê²Œ í•œë‹¤.
2. ì„œë²„ í˜¸ì¶œì„ ë°›ì€ í›„ ë’¤ì— ë³´ê³  ìˆë˜ ë¦¬ìŠ¤íŠ¸ ë’¤ì— ë¶™ì—¬ì¤˜ì•¼í•œë‹¤.
3. í™”ë©´ì„ ì™”ë‹¤ê°”ë‹¤ ì´ë™í•˜ë©´ì„œ ë°ì´í„°ë¥¼ ì‚¬ìš©ìê°€ ë³´ê³ ìˆë˜ í™”ë©´ì„ ê·¸ëŒ€ë¡œ ë³´ì—¬ì¤˜ì•¼í•˜ëŠ” ì‘ì—…ë„ í•„ìš”í•˜ë‹¤.

ì—¬ëŸ¬ê°€ì§€ ì„¤ì •í•´ì£¼ê³  ì‹ ê²½ì¨ì•¼í•  ë¶€ë¶„ë“¤ì´ ë§ì£ .

í•˜ì§€ë§Œ ì•ˆë“œë¡œì´ë“œì—ì„œë„ ì´ëŸ° ë¶€ë¶„ì„ ìƒê°í•˜ê³  í¸ì˜ì„±ì„ ì œê³µí•˜ê¸° ìœ„í•´ Paging3ì´ë¼ëŠ” Jetpack Libraryë¥¼ ì œê³µí•´ì£¼ê³  ìˆì–´ìš”! ğŸ‘

Paging3 ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ë¡œì»¬ ì €ì¥ì†Œì—ì„œë‚˜ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ë‚˜ëˆ„ì–´ íš¨ìœ¨ì ìœ¼ë¡œ ë¡œë”©í•  ìˆ˜ ìˆê²Œ ë„ì™€ì¤˜ìš”.

Paging3ëŠ” êµ¬ê¸€ì—ì„œ ê¶Œì¥í•˜ëŠ” Android ì•± ì•„í‚¤í…ì²˜ì— ë§ê²Œ ì„¤ê³„ë˜ì—ˆìœ¼ë©°, ë‹¤ë¥¸ Jetpack ì»´í¬ë„ŒíŠ¸ì™€ ì˜ ë™ì‘í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„ë˜ì—ˆì–´ìš”.

**Paging3ì˜ ì¥ì **

- í˜ì´ì§• ëœ ë°ì´í„°ì˜ ë©”ëª¨ë¦¬ ë‚´ ìºì‹±.
    
    â†’  ì´ë ‡ê²Œ í•˜ë©´ ì•±ì´ í˜ì´ì§• ë°ì´í„°ë¡œ ì‘ì—…í•˜ëŠ” ë™ì•ˆ ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ìš”.
    
- ìš”ì²­ ì¤‘ë³µ ì œê±° ê¸°ëŠ¥ì´ ê¸°ë³¸ìœ¼ë¡œ ì œê³µë˜ì–´ ì•±ì—ì„œ ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­í­ê³¼ ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì‚¬ìš©ìê°€ ë¡œë“œëœ ë°ì´í„°ì˜ ëê¹Œì§€ ìŠ¤í¬ë¡¤í•  ë•Œ êµ¬ì„± ê°€ëŠ¥í•œ RecyclerViewÂ ì–´ëŒ‘í„°ê°€ ìë™ìœ¼ë¡œ ë°ì´í„°ë¥¼ ìš”ì²­í•©ë‹ˆë‹¤.
- Kotlin ì½”ë£¨í‹´ ë° Flowë¿ë§Œ ì•„ë‹ˆë¼ LiveDataÂ ë° RxJavaë¥¼ ìµœê³  ìˆ˜ì¤€ìœ¼ë¡œ ì§€ì›
- ìƒˆë¡œê³ ì¹¨ ë° ì¬ì‹œë„ ê¸°ëŠ¥ì„ í¬í•¨í•˜ì—¬ ì˜¤ë¥˜ ì²˜ë¦¬ë¥¼ ê¸°ë³¸ìœ¼ë¡œ ì§€ì›

Pagingì„ ì‚¬ìš©í•˜ë ¤ë©´

**Gradle**

```kotlin
dependencies {
  def paging_version = "3.0.0" // ë²„ì „ í™•ì¸ í•„ìš”

  implementation "androidx.paging:paging-runtime:$paging_version"

  // alternatively - without Android dependencies for tests
  testImplementation "androidx.paging:paging-common:$paging_version"

  // optional - RxJava2 support
  implementation "androidx.paging:paging-rxjava2:$paging_version"

  // optional - RxJava3 support
  implementation "androidx.paging:paging-rxjava3:$paging_version"

  // optional - Guava ListenableFuture support
  implementation "androidx.paging:paging-guava:$paging_version"

  // optional - Jetpack Compose integration
  implementation "androidx.paging:paging-compose:1.0.0-alpha09"
}
```

**PagingSource**

```kotlin
// ì œê°€ ì‚¬ìš©í•˜ë˜ ì½”ë“œë¥¼ ê°€ì ¸ì™”ì–´ìš”ã…ã…
class BookMarkPaging(
    private val categoryId: Int,
    private val bookmarkApi: BookmarkApi
) : PagingSource<Int, Job>() {

    /**
     * ë¦¬í”„ë ˆì‹œ ë˜ëŠ” ì¬ë¡œë“œí•  ë•Œ ì´ì „ positionì—ì„œ ì¤‘ë‹¨ëœ page(key)ê°’ì„ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
    - state.anchorPosition : ìµœê·¼ position
    - prevKey == null -> ì²« í˜ì´ì§€
    - nextKey == null -> ë§ˆì§€ë§‰ í˜ì´ì§€
    - prevKey == null && nextKey == null -> í˜ì´ì§€ê°€ ë‹¨ í•œê°œ
     */
    override fun getRefreshKey(state: PagingState<Int, Job>): Int? {
        return state.anchorPosition?.let {
            //anchorPage : anchorPosition ê³¼ ê°€ì¥ ê°€ê¹Œìš´ í˜ì´ì§€(prevKey, nextKey)ê°’. anchorPage ëŠ” prevKey ì™€ nextKey ë§Œì„ ê°€ì§€ê³  ìˆìŒ.
            val anchorPage = state.closestPageToPosition(it)
            //í˜„ì¬ anchorPosition ì˜ í˜ì´ì§€(key)ê°’ë¥¼ ë¦¬í„´. prevKey ê°€ null ì¼ ì‹œ (nextKey+1)ê°’ ë¦¬í„´.
            anchorPage?.prevKey?.plus(1) ?: anchorPage?.nextKey?.minus(1)
        }
    }

    /**
     * í˜ì´ì§• ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜. í˜ì´ì§€ê°€ ë¡œë”©ë  ë•Œ ì‹¤í–‰
     * LoadResult<page, data> : ë¡œë”©ëœ ë°ì´í„°. load()í•¨ìˆ˜ì˜ ë¦¬í„´ê°’
    - data : ë¦¬ì‚¬ì´í´ëŸ¬ë·°ì— ì „ë‹¬í•  ë°ì´í„°
    - prevKey : í˜„ì¬ pageê°€ ì²« í˜ì´ì§€(page == STARTING_PAGE_INDEX)ì¼ì‹œ null
    - nextKey : í˜„ì¬ pageê°€ ë§ˆì§€ë§‰ í˜ì´ì§€ì¼ì‹œ null
     */
    override suspend fun load(params: LoadParams<Int>): LoadResult<Int, Job> {
        // ë°ì´í„°ë¥¼ ë¡œë”©í•´ì˜¬ í˜„ì¬ í˜ì´ì§€ê°’. params.key==null ì´ë©´ ì²« í˜ì´ì§€ ì´ë¯€ë¡œ STARTING_PAGE_INDEX ë¥¼ ë¦¬í„´
        val page = params.key ?: STARTING_PAGE_INDEX
        return try {
            // ë¦¬ì‚¬ì´í´ëŸ¬ë·°ì— ì „ë‹¬í•  ë°ì´í„° ë¦¬ìŠ¤íŠ¸
            val data =
                bookmarkApi.getJobs(categoryId, page * PAGE_SIZE, PAGE_SIZE)
                    .awaitResponse().body()?.data
            val last =
                bookmarkApi.getJobs(categoryId, page * PAGE_SIZE, PAGE_SIZE)
                    .awaitResponse().body()?.total!!

            LoadResult.Page(
                data = data!!,
                prevKey = if (page == STARTING_PAGE_INDEX) null else page - 1,
                nextKey = if (0 >= last - page * PAGE_SIZE) null else page + 1
            )
        } catch (e: Exception) {
            LoadResult.Error(e)
        }
    }
}
```

êµ¬í˜„í•´ì•¼ í•  ë©”ì„œë“œëŠ” load()ì™€ getRefreshKey()ê°€ ìˆìŠµë‹ˆë‹¤. 

- load()ëŠ” paramsì„ ë°”íƒ•ìœ¼ë¡œ í˜ì´ì§€ì˜ ë°ì´í„°ë¥¼ ë°˜í™˜í•˜ê²Œ ë©ë‹ˆë‹¤.
    
    â†’  load()ì˜ ì¸ìë¡œ ë„˜ì–´ì˜¤ëŠ” paramsì˜ key ê°’ì´ í˜ì´ì§€ ì •ë³´ì…ë‹ˆë‹¤. ì¶”ê°€ì ìœ¼ë¡œ loadSizeë„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.
    
- getRefreshKey()ëŠ” refreshì‹œ ë‹¤ì‹œ ì‹œì‘í•  keyë¥¼ ë°˜í™˜í•´ì£¼ë©´ ë©ë‹ˆë‹¤.

returnì¸ LoadResultëŠ” Page, Error ë‘ ê°€ì§€ê°€ ìˆìŠµë‹ˆë‹¤. 

- LoadResult.PageëŠ” ì •ìƒì ì¸ ê²½ìš°ì¼ ë•Œ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤. ë§Œì•½ ë‹¤ìŒ ë°ì´í„°ë¥¼ ë” ì´ìƒ í˜¸ì¶œí•˜ì§€ ì•Šìœ¼ë ¤ë©´ nextKey ê°’ì„ nullë¡œ ì£¼ë©´ ë©ë‹ˆë‹¤.
- LoadResult.ErrorëŠ” Exception ë°œìƒì´ë‚˜ ë°ì´í„°ê°€ ë¬¸ì œê°€ ìˆì„ ê²½ìš° ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.

getRefreshKey()ëŠ” PagingStateë¥¼ ì¸ìë¡œ ë°›ìŠµë‹ˆë‹¤. 

â†’  PagingStateëŠ” ë¡œë“œëœ í˜ì´ì§€ ë° ë§ˆì§€ë§‰ìœ¼ë¡œ ì•¡ì„¸ìŠ¤ í•œ ìœ„ì¹˜ ë“±ì˜ í˜ì´ì§• ì‹œìŠ¤í…œì˜ ìŠ¤ëƒ…ìƒ· ìƒíƒœë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.

**PagingApi**

```kotlin
interface BookmarkApi {
    @GET("/jobs/like") // ì¼ìë¦¬ ê²€ìƒ‰ ê²°ê³¼
    fun getJobs(
        @Query("categoryId") categoryId: Int,
        @Query("start") start: Int, @Query("perPage") perPage: Int,
    ): Call<JobResponse>
	...
}
```

**ViewModel**

```kotlin
class BookmarkViewModel(
    private val bookmarkApi: BookmarkApi
) : ViewModel() {

    val list = Pager(PagingConfig(pageSize = PAGE_SIZE)) {
            BookMarkPaging(1, bookmarkApi)
        }.liveData.cachedIn(viewModelScope)
		...

		// ë§Œì•½ ê²€ìƒ‰í•  ë•Œ ë³€ë™ë˜ëŠ” ê°’ì„ ì¸ì‹í•´ pagingì„ ì‚¬ìš©í•˜ê³  ì‹¶ë‹¤ë©´
		val text = MutableLiveData("")
		// text ê°’ì´ ë³€í•˜ë©´ ìƒˆë¡œìš´ listë¥¼ í˜¸ì¶œí•œë‹¤.
		val searchList = text.switchMap {
        Pager(PagingConfig(pageSize = PAGE_SIZE)) {
            BookMarkPaging(1, bookmarkApi)
        }.liveData.cachedIn(viewModelScope)
    }
}
   
```

**Fragment**

```kotlin
viewModel.list.observe(viewLifecycleOwner) { data ->

    jobListAdapter.mCategoryId = 1
    jobListAdapter.submitData(lifecycle, data)
}
```

jobListAdapter.submitData(lifecycle, data)

â†’ ì‹¤ì œë¡œ ë°ì´í„°ë¥¼ ë„£ì–´ì£¼ëŠ” ë¶€ë¶„ì€ ì´ ë¶€ë¶„ ë¿ì´ë‹¤.

**PagingDataAdapter**

```kotlin
class JobListAdapter : PagingDataAdapter<Job, JobListAdapter.MyViewHolder>(DIFF_UTIL) {
    
    var mCategoryId: Int = 0

    override fun onBindViewHolder(holder: MyViewHolder, position: Int) {
        val data = getItem(position)
        holder.binding.apply {
						// xmlì—ì„œ variableí•œ ê°’ì„ ì„¸íŒ…í•´ì£¼ëŠ” ê³³
            setVariable(BR.item, data)
            setVariable(BR.categoryId, mCategoryId) 
        }
    }

    inner class MyViewHolder(val binding: ItemJobBinding) : RecyclerView.ViewHolder(binding.root) {}

    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): MyViewHolder {
        return MyViewHolder(
            ItemJobBinding.inflate(LayoutInflater.from(parent.context), parent, false)
        )
    }

    companion object {
        //DiffCallback : areItemsTheSame()ì„ ë¨¼ì € ë¹„êµí•˜ê³ , ê²°ê³¼ì— ë”°ë¼ ì•„ì´í…œ ë³€ê²½ ì‚¬í•­ì„ ì²˜ë¦¬í•œë‹¤.
        //               ê·¸ í›„ areItemsTheSame()ì˜ ê²°ê³¼ ì •ë³´ë¥¼ ê¸°ì¤€ìœ¼ë¡œ areContentsTheSame()ì„ í•œ ë²ˆ ë” ì²´í¬í•œë‹¤.
        val DIFF_UTIL = object : DiffUtil.ItemCallback<Job>() {

            //í˜„ì¬ ë¦¬ìŠ¤íŠ¸ì— ë…¸ì¶œí•˜ê³  ìˆëŠ” ì•„ì´í…œ(old)ê³¼ ìƒˆë¡œìš´ ì•„ì´í…œ(new)ì˜ ID ê°’ì´ ì„œë¡œ ê°™ì€ì§€ ë¹„êµí•œë‹¤.
            override fun areItemsTheSame(oldItem: Job, newItem: Job): Boolean {
                return oldItem.id == newItem.id
            }

            //í˜„ì¬ ë¦¬ìŠ¤íŠ¸ì— ë…¸ì¶œí•˜ê³  ìˆëŠ” ì•„ì´í…œ(old)ê³¼ ìƒˆë¡œìš´ ì•„ì´í…œ(new)ì˜ ë‚´ìš©ì´ ì„œë¡œ ê°™ì€ì§€ ë¹„êµí•œë‹¤.
            override fun areContentsTheSame(oldItem: Job, newItem: Job): Boolean {
                return oldItem == newItem
            }
        }
    }
}
```

ì´ë ‡ê²Œ í•˜ë©´ ëì´ë‹¤.

ListViewë‚˜ RecyclerViewì˜ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ë¥¼ ë³´ë©° ìƒˆë¡œ ë°ì´í„°ë¥¼ ë°›ì•„ì£¼ê³  ë­ í•´ì£¼ê³  ë” í•´ì£¼ê³  í•  í•„ìš”ê°€ ì—†ë‹¤.

í•˜ì§€ë§Œ! ë‹¨ì ë„ ìˆì£ .

ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ë‹¤ë³´ë©´ ì‚­ì œí•˜ëŠ” ê¸°ëŠ¥ì´ë‚˜ ì¶”ê°€í•´ì•¼í•˜ëŠ” ê¸°ëŠ¥ë„ ìˆëŠ”ë° Room Libraryë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ì´ ë¶€ë¶„ì´ ì‰½ì§€ëŠ” ì•Šë‹¤â€¦ ë„ˆë¬´ í˜ë“¤ì—ˆë‹¤.

ë‚˜ëŠ” ê·¸ëƒ¥ ë‹¤ì‹œ ë°ì´í„°ë¥¼ ìƒˆë¡œ ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒìœ¼ë¡œ í–ˆëŠ”ë° ë¬¼ë¡  ì¢‹ì€ ë°©ë²•ì€ ì•„ë‹ˆì˜€ë‹¤

ë§ì´ ì°¾ì•„ë³´ë‹¤ê°€ ê²°êµ­ ì´ë ‡ê²Œ ê°œë°œí–ˆì§€ë§Œ ìì£¼ ë°ì´í„°ë¥¼ delete, modify í•´ì•¼í•œë‹¤ë©´ Paging3ë¥¼ ì“°ì§€ ì•ŠëŠ” ê²ƒë„ ë°©ë²•ìœ¼ë¡œ ìƒê°í•œë‹¤.

ë‹¨ìˆœ ë¦¬ìŠ¤íŠ¸ë¥¼ í˜¸ì¶œí•´ì•¼í•œë‹¤ë©´?! ë¬´ì¡°ê±´ Paging3ë¥¼ ì‚¬ìš©í•  ê²ƒ ê°™ë‹¤~

ë‹¤ìŒ ê¸€ì—ì„œëŠ” Paging3ë¥¼ ì˜ í™œìš©í•˜ê¸° ìœ„í•œ ê¸€ì´ ë  ê²ƒ ê°™ë‹¤.